name: deploy
on:
  workflow_run:
    workflows: 
      - Build-Docker
    branches: [ main ]
    types:
      - completed
jobs:
    deploy:
      name: deploy-firebase
      runs-on: ubuntu-latest
      needs: build
      if: ${{ github.event.workflow_run.conclusion == 'success' }}
      steps:
        - name: Checkout repository
          uses: actions/checkout@main
        - name: 'Upload artifact'
          uses: actions/upload-artifact@main
          with:
            name: deploy-artifact
            path: deploy_artifact.txt
        - name: Deploy to Firebase
          uses: w9jds/firebase-action@master
          with:
            args: deploy --only hosting
          env:
            FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN}}
        - name: 'Download artifact'
          uses: actions/download-artifact@main
          with:
            name: build-artifact
        - name: 'Display artifact'
          run: cat build_artifact.txt